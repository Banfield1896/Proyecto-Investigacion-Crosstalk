<!-- saved from url=(0014)about:internet -->
<html>
<body>
<script src="resources/eml_report_loadable_data.js"></script>
<pre class="code">
<span class="srcline"><span class="lineno"><a href="95,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T27U3">cLL</span>, <span class="var type1" id="S3T27U4">cLR</span>] = transaural_ir3(<span class="var type1" id="S4T3U7">D</span>, <span class="var type1" id="S5T3U8">dp</span>, <span class="var type1" id="S6T3U9">do</span>, <span class="var type1" id="S7T3U10">beta</span>, <span class="var type2" id="S8T3V1U11">nSamplesIR</span>, <span class="var type1" id="S9T3U12">fs</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="95,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">% Versión corregida y optimizada para la generación de código C++.</span></span></span>
<span class="srcline"><span class="lineno"><a href="95,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">% - Pre-asigna memoria para todas las matrices.</span></span></span>
<span class="srcline"><span class="lineno"><a href="95,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">% - Devuelve únicamente las dos IRs necesarias (cLL y cLR).</span></span></span>
<span class="srcline"><span class="lineno"><a href="95,5" id="srcline5"> 5</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="95,6" id="srcline6"> 6</a></span><span class="line"><span class="comment">% --- Pre-asignación de memoria ---</span></span></span>
<span class="srcline"><span class="lineno"><a href="95,7" id="srcline7"> 7</a></span><span class="line"><span class="comment">% Esto le dice a MATLAB Coder el tamaño exacto de las matrices de antemano.</span></span></span>
<span class="srcline"><span class="lineno"><a href="95,8" id="srcline8"> 8</a></span><span class="line"><span class="mxinfo " id="T79:U9"><span class="var type1" id="S10T79U15">C</span> = <span class="mxinfo " id="T79:U11">complex(<span class="mxinfo " id="T80:U12">zeros(<span class="mxinfo " id="T3:U13">2</span>, <span class="mxinfo " id="T3:U14">2</span>, <span class="mxinfo " id="T3:U15"><span class="var type1" id="S8T3U23">nSamplesIR</span>/2</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="95,9" id="srcline9"> 9</a></span><span class="line"><span class="comment">% H no es necesario si no se devuelve H2.</span></span></span>
<span class="srcline"><span class="lineno"><a href="95,10" id="srcline10">10</a></span><span class="line"><span class="comment">% C2 y H2 tampoco son necesarios si no se devuelven.</span></span></span>
<span class="srcline"><span class="lineno"><a href="95,11" id="srcline11">11</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="95,12" id="srcline12">12</a></span><span class="line"><span class="mxinfo " id="T3:U17"><span class="var type1" id="S13T3U27">c</span> = <span class="mxinfo " id="T3:U19">345</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="95,13" id="srcline13">13</a></span><span class="line"><span class="keyword">if</span> mod(<span class="var type1" id="S8T3U34">nSamplesIR</span>, 2) == 1 </span></span>
<span class="srcline"><span class="lineno"><a href="95,14" id="srcline14">14</a></span><span class="line">    <span class="var type0" id="S8T0U39">nSamplesIR</span> = <span class="var type0" id="S8T0U41">nSamplesIR</span> + 1;</span></span>
<span class="srcline"><span class="lineno"><a href="95,15" id="srcline15">15</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="95,16" id="srcline16">16</a></span><span class="line"><span class="mxinfo " id="T39:U21"><span class="var type1" id="S15T39U45">f</span> = <span class="mxinfo " id="T39:U23"><span class="mxinfo " id="T39:U24">(0:<span class="var type1" id="S8T3U53">nSamplesIR</span>/2-1) / <span class="var type1" id="S8T3U56">nSamplesIR</span></span> * <span class="var type1" id="S9T3U57">fs</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="95,17" id="srcline17">17</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="95,18" id="srcline18">18</a></span><span class="line"><span class="mxinfo " id="T3:U28"><span class="var type1" id="S16T3U60">dLL</span> = <span class="mxinfo " id="T3:U30"><span class="potentialdiff PD1">sqrt(<span class="mxinfo " id="T3:U31"><span class="mxinfo " id="T3:U32"><span class="var type1" id="S4T3U65">D</span>^2</span> + <span class="mxinfo " id="T3:U34">(<span class="mxinfo " id="T3:U35"><span class="mxinfo " id="T3:U36"><span class="var type1" id="S5T3U71">dp</span>/<span class="mxinfo " id="T3:U38">2</span></span> - <span class="mxinfo " id="T3:U39"><span class="var type1" id="S6T3U74">do</span>/<span class="mxinfo " id="T3:U41">2</span></span></span>)^2</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="95,19" id="srcline19">19</a></span><span class="line"><span class="mxinfo " id="T3:U42"><span class="var type1" id="S18T3U79">dLR</span> = <span class="mxinfo " id="T3:U44"><span class="potentialdiff PD1">sqrt(<span class="mxinfo " id="T3:U45"><span class="mxinfo " id="T3:U46"><span class="var type1" id="S4T3U84">D</span>^2</span> + <span class="mxinfo " id="T3:U48">(<span class="mxinfo " id="T3:U49"><span class="mxinfo " id="T3:U50"><span class="var type1" id="S5T3U90">dp</span>/<span class="mxinfo " id="T3:U52">2</span></span> + <span class="mxinfo " id="T3:U53"><span class="var type1" id="S6T3U93">do</span>/<span class="mxinfo " id="T3:U55">2</span></span></span>)^2</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="95,20" id="srcline20">20</a></span><span class="line"><span class="mxinfo " id="T3:U56"><span class="var type1" id="S19T3U98">tLL</span> = <span class="mxinfo " id="T3:U58"><span class="var type1" id="S16T3U100">dLL</span>/<span class="var type1" id="S13T3U101">c</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="95,21" id="srcline21">21</a></span><span class="line"><span class="mxinfo " id="T3:U61"><span class="var type1" id="S20T3U104">tLR</span> = <span class="mxinfo " id="T3:U63"><span class="var type1" id="S18T3U106">dLR</span>/<span class="var type1" id="S13T3U107">c</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="95,22" id="srcline22">22</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="95,23" id="srcline23">23</a></span><span class="line"><span class="comment">% Cálculo de la matriz de transferencia en frecuencia</span></span></span>
<span class="srcline"><span class="lineno"><a href="95,24" id="srcline24">24</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S21T3U110">naux</span> = <span class="mxinfo " id="T3:U67">1</span>:<span class="var type1" id="S8T3U114">nSamplesIR</span>/2</span></span>
<span class="srcline"><span class="lineno"><a href="95,25" id="srcline25">25</a></span><span class="line">    <span class="mxinfo " id="T3:U69"><span class="var type1" id="S22T3U118">w</span> = <span class="mxinfo " id="T3:U71"><span class="mxinfo " id="T3:U72"><span class="mxinfo " id="T3:U73">2</span> * <span class="mxinfo " id="T3:U74">pi</span></span> * <span class="mxinfo " id="T3:U75"><span class="var type1" id="S15T39U125">f</span>(<span class="var type1" id="S21T3U126">naux</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="95,26" id="srcline26">26</a></span><span class="line">    <span class="mxinfo " id="T50:U78"><span class="var type1" id="S24T50U129">Haux0</span> = <span class="mxinfo " id="T50:U80">[<span class="mxinfo " id="T81:U81"><span class="mxinfo " id="T47:U82"><span class="mxinfo " id="T47:U83">exp(<span class="mxinfo " id="T47:U84"><span class="mxinfo " id="T47:U85"><span class="mxinfo " id="T47:U86">-1i</span>*<span class="var type1" id="S22T3U139">w</span></span>*<span class="var type1" id="S19T3U140">tLL</span></span>)</span>/<span class="var type1" id="S16T3U141">dLL</span></span>, <span class="mxinfo " id="T47:U90"><span class="mxinfo " id="T47:U91">exp(<span class="mxinfo " id="T47:U92"><span class="mxinfo " id="T47:U93"><span class="mxinfo " id="T47:U94">-1i</span>*<span class="var type1" id="S22T3U149">w</span></span>*<span class="var type1" id="S20T3U150">tLR</span></span>)</span>/<span class="var type1" id="S18T3U151">dLR</span></span></span>; <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="95,27" id="srcline27">27</a></span><span class="line">             <span class="mxinfo " id="T81:U98"><span class="mxinfo " id="T47:U99"><span class="mxinfo " id="T47:U100">exp(<span class="mxinfo " id="T47:U101"><span class="mxinfo " id="T47:U102"><span class="mxinfo " id="T47:U103">-1i</span>*<span class="var type1" id="S22T3U160">w</span></span>*<span class="var type1" id="S20T3U161">tLR</span></span>)</span>/<span class="var type1" id="S18T3U162">dLR</span></span>, <span class="mxinfo " id="T47:U107"><span class="mxinfo " id="T47:U108">exp(<span class="mxinfo " id="T47:U109"><span class="mxinfo " id="T47:U110"><span class="mxinfo " id="T47:U111">-1i</span>*<span class="var type1" id="S22T3U170">w</span></span>*<span class="var type1" id="S19T3U171">tLL</span></span>)</span>/<span class="var type1" id="S16T3U172">dLL</span></span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="95,28" id="srcline28">28</a></span><span class="line">    <span class="mxinfo " id="T50:U115"><span class="mxinfo " id="T50:U116"><span class="var type1" id="S10T79U176">C</span>(<span class="mxinfo " id="T82:U118">:</span>,<span class="mxinfo " id="T82:U119">:</span>,<span class="var type1" id="S21T3U179">naux</span>)</span> = <span class="mxinfo " id="T50:U121"><span class="mxinfo " id="T50:U122">inv((<span class="mxinfo " id="T50:U123"><span class="mxinfo " id="T50:U124"><span class="mxinfo " id="T50:U125"><span class="var type1" id="S24T50U187">Haux0</span>'</span> * <span class="var type1" id="S24T50U188">Haux0</span></span> + <span class="mxinfo " id="T53:U128"><span class="var type1" id="S7T3U190">beta</span> * <span class="mxinfo " id="T53:U130">eye(2)</span></span></span>))</span> * <span class="mxinfo " id="T50:U131"><span class="var type1" id="S24T50U195">Haux0</span>'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="95,29" id="srcline29">29</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="95,30" id="srcline30">30</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="95,31" id="srcline31">31</a></span><span class="line"><span class="comment">% Reconstrucción del espectro completo con simetría Hermitiana</span></span></span>
<span class="srcline"><span class="lineno"><a href="95,32" id="srcline32">32</a></span><span class="line"><span class="mxinfo " id="T63:U133"><span class="var type1" id="S28T63U198">CLL_spec</span> = <span class="mxinfo " id="T63:U135">[<span class="mxinfo " id="T60:U136">squeeze(<span class="mxinfo " id="T58:U137"><span class="var type1" id="S10T79U204">C</span>(<span class="mxinfo " id="T30:U139">1</span>,<span class="mxinfo " id="T30:U140">1</span>,<span class="mxinfo " id="T83:U141">:</span>)</span>)</span>; <span class="mxinfo " id="T47:U142">0</span>; <span class="mxinfo " id="T62:U143">conj(<span class="mxinfo " id="T62:U144">squeeze(<span class="mxinfo " id="T61:U145"><span class="var type1" id="S10T79U216">C</span>(<span class="mxinfo " id="T30:U147">1</span>,<span class="mxinfo " id="T30:U148">1</span>,<span class="mxinfo " id="T84:U149">end:-1:2</span>)</span>)</span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="95,33" id="srcline33">33</a></span><span class="line"><span class="mxinfo " id="T63:U150"><span class="var type1" id="S32T63U228">CLR_spec</span> = <span class="mxinfo " id="T63:U152">[<span class="mxinfo " id="T60:U153">squeeze(<span class="mxinfo " id="T58:U154"><span class="var type1" id="S10T79U234">C</span>(<span class="mxinfo " id="T30:U156">2</span>,<span class="mxinfo " id="T30:U157">1</span>,<span class="mxinfo " id="T83:U158">:</span>)</span>)</span>; <span class="mxinfo " id="T47:U159">0</span>; <span class="mxinfo " id="T62:U160">conj(<span class="mxinfo " id="T62:U161">squeeze(<span class="mxinfo " id="T61:U162"><span class="var type1" id="S10T79U246">C</span>(<span class="mxinfo " id="T30:U164">2</span>,<span class="mxinfo " id="T30:U165">1</span>,<span class="mxinfo " id="T84:U166">end:-1:2</span>)</span>)</span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="95,34" id="srcline34">34</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="95,35" id="srcline35">35</a></span><span class="line"><span class="comment">% Obtener la respuesta al impulso (real)</span></span></span>
<span class="srcline"><span class="lineno"><a href="95,36" id="srcline36">36</a></span><span class="line"><span class="mxinfo " id="T27:U167"><span class="var type1" id="S2T27U258">cLL</span> = <span class="mxinfo " id="T27:U169">real(<span class="mxinfo " id="T63:U170">ifft(<span class="var type1" id="S28T63U263">CLL_spec</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="95,37" id="srcline37">37</a></span><span class="line"><span class="mxinfo " id="T27:U172"><span class="var type1" id="S3T27U266">cLR</span> = <span class="mxinfo " id="T27:U174">real(<span class="mxinfo " id="T63:U175">ifft(<span class="var type1" id="S32T63U271">CLR_spec</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="95,38" id="srcline38">38</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="95,39" id="srcline39">39</a></span><span class="line"><span class="comment">% Aplicar un pequeño retardo para hacer la respuesta causal</span></span></span>
<span class="srcline"><span class="lineno"><a href="95,40" id="srcline40">40</a></span><span class="line"><span class="mxinfo " id="T3:U177"><span class="var type1" id="S35T3U274">tdelay</span> = <span class="mxinfo " id="T3:U179">0.01</span></span>; <span class="comment">% 10 ms delay</span></span></span>
<span class="srcline"><span class="lineno"><a href="95,41" id="srcline41">41</a></span><span class="line"><span class="mxinfo " id="T3:U180"><span class="var type1" id="S36T3U278">ntdelay</span> = <span class="mxinfo " id="T3:U182">round(<span class="mxinfo " id="T3:U183"><span class="var type1" id="S35T3U282">tdelay</span> * <span class="var type1" id="S9T3U283">fs</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="95,42" id="srcline42">42</a></span><span class="line"><span class="mxinfo " id="T27:U186"><span class="var type1" id="S2T27U286">cLL</span> = <span class="mxinfo " id="T27:U188">circshift(<span class="var type1" id="S2T27U289">cLL</span>, <span class="var type1" id="S36T3U290">ntdelay</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="95,43" id="srcline43">43</a></span><span class="line"><span class="mxinfo " id="T27:U191"><span class="var type1" id="S3T27U293">cLR</span> = <span class="mxinfo " id="T27:U193">circshift(<span class="var type1" id="S3T27U296">cLR</span>, <span class="var type1" id="S36T3U297">ntdelay</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="95,44" id="srcline44">44</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="95,45" id="srcline45">45</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
</body>
</html>
