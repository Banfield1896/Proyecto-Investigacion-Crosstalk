<!-- saved from url=(0014)about:internet -->
<html>
<body>
<script src="resources/eml_report_loadable_data.js"></script>
<pre class="code">
<span class="srcline"><span class="lineno"><a href="104,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T26U3">cLL</span>, <span class="var type1" id="S3T26U4">cLR</span>] = transaural_ir3(<span class="var type1" id="S4T3U7">D</span>, <span class="var type1" id="S5T3U8">dp</span>, <span class="var type1" id="S6T3U9">do</span>, <span class="var type1" id="S7T3U10">beta</span>, <span class="var type2" id="S8T3V1U11">nSamplesIR</span>, <span class="var type1" id="S9T3U12">fs</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="104,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">% Versión corregida y optimizada para la generación de código C++.</span></span></span>
<span class="srcline"><span class="lineno"><a href="104,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">% - Pre-asigna memoria para todas las matrices.</span></span></span>
<span class="srcline"><span class="lineno"><a href="104,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">% - Devuelve únicamente las dos IRs necesarias (cLL y cLR).</span></span></span>
<span class="srcline"><span class="lineno"><a href="104,5" id="srcline5"> 5</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="104,6" id="srcline6"> 6</a></span><span class="line"><span class="comment">% --- Pre-asignación de memoria ---</span></span></span>
<span class="srcline"><span class="lineno"><a href="104,7" id="srcline7"> 7</a></span><span class="line"><span class="comment">% Esto le dice a MATLAB Coder el tamaño exacto de las matrices de antemano.</span></span></span>
<span class="srcline"><span class="lineno"><a href="104,8" id="srcline8"> 8</a></span><span class="line"><span class="mxinfo " id="T81:U9"><span class="var type1" id="S10T81U15">C</span> = <span class="mxinfo " id="T81:U11">complex(<span class="mxinfo " id="T82:U12">zeros(<span class="mxinfo " id="T3:U13">2</span>, <span class="mxinfo " id="T3:U14">2</span>, <span class="mxinfo " id="T3:U15"><span class="var type1" id="S8T3U23">nSamplesIR</span>/2</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="104,9" id="srcline9"> 9</a></span><span class="line"><span class="comment">% H no es necesario si no se devuelve H2.</span></span></span>
<span class="srcline"><span class="lineno"><a href="104,10" id="srcline10">10</a></span><span class="line"><span class="comment">% C2 y H2 tampoco son necesarios si no se devuelven.</span></span></span>
<span class="srcline"><span class="lineno"><a href="104,11" id="srcline11">11</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="104,12" id="srcline12">12</a></span><span class="line"><span class="mxinfo " id="T3:U17"><span class="var type1" id="S13T3U27">c</span> = <span class="mxinfo " id="T3:U19">345</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="104,13" id="srcline13">13</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T6:U20"><span class="mxinfo " id="T3:U21">mod(<span class="var type1" id="S8T3U34">nSamplesIR</span>, 2)</span> == <span class="mxinfo " id="T3:U23">1</span></span> </span></span>
<span class="srcline"><span class="lineno"><a href="104,14" id="srcline14">14</a></span><span class="line">    <span class="var type0" id="S8T0U39">nSamplesIR</span> = <span class="var type0" id="S8T0U41">nSamplesIR</span> + 1;</span></span>
<span class="srcline"><span class="lineno"><a href="104,15" id="srcline15">15</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="104,16" id="srcline16">16</a></span><span class="line"><span class="mxinfo " id="T36:U24"><span class="var type1" id="S15T36U45">f</span> = <span class="mxinfo " id="T36:U26"><span class="mxinfo " id="T36:U27">(0:<span class="var type1" id="S8T3U53">nSamplesIR</span>/2-1) / <span class="var type1" id="S8T3U56">nSamplesIR</span></span> * <span class="var type1" id="S9T3U57">fs</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="104,17" id="srcline17">17</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="104,18" id="srcline18">18</a></span><span class="line"><span class="mxinfo " id="T3:U31"><span class="var type1" id="S16T3U60">dLL</span> = <span class="mxinfo " id="T3:U33"><span class="potentialdiff PD1">sqrt(<span class="mxinfo " id="T3:U34"><span class="mxinfo " id="T3:U35"><span class="var type1" id="S4T3U65">D</span>^2</span> + <span class="mxinfo " id="T3:U37">(<span class="mxinfo " id="T3:U38"><span class="mxinfo " id="T3:U39"><span class="var type1" id="S5T3U71">dp</span>/<span class="mxinfo " id="T3:U41">2</span></span> - <span class="mxinfo " id="T3:U42"><span class="var type1" id="S6T3U74">do</span>/<span class="mxinfo " id="T3:U44">2</span></span></span>)^2</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="104,19" id="srcline19">19</a></span><span class="line"><span class="mxinfo " id="T3:U45"><span class="var type1" id="S18T3U79">dLR</span> = <span class="mxinfo " id="T3:U47"><span class="potentialdiff PD1">sqrt(<span class="mxinfo " id="T3:U48"><span class="mxinfo " id="T3:U49"><span class="var type1" id="S4T3U84">D</span>^2</span> + <span class="mxinfo " id="T3:U51">(<span class="mxinfo " id="T3:U52"><span class="mxinfo " id="T3:U53"><span class="var type1" id="S5T3U90">dp</span>/<span class="mxinfo " id="T3:U55">2</span></span> + <span class="mxinfo " id="T3:U56"><span class="var type1" id="S6T3U93">do</span>/<span class="mxinfo " id="T3:U58">2</span></span></span>)^2</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="104,20" id="srcline20">20</a></span><span class="line"><span class="mxinfo " id="T3:U59"><span class="var type1" id="S19T3U98">tLL</span> = <span class="mxinfo " id="T3:U61"><span class="var type1" id="S16T3U100">dLL</span>/<span class="var type1" id="S13T3U101">c</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="104,21" id="srcline21">21</a></span><span class="line"><span class="mxinfo " id="T3:U64"><span class="var type1" id="S20T3U104">tLR</span> = <span class="mxinfo " id="T3:U66"><span class="var type1" id="S18T3U106">dLR</span>/<span class="var type1" id="S13T3U107">c</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="104,22" id="srcline22">22</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="104,23" id="srcline23">23</a></span><span class="line"><span class="comment">% Cálculo de la matriz de transferencia en frecuencia</span></span></span>
<span class="srcline"><span class="lineno"><a href="104,24" id="srcline24">24</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S21T3U110">naux</span> = <span class="mxinfo " id="T3:U70">1</span>:<span class="var type1" id="S8T3U114">nSamplesIR</span>/2</span></span>
<span class="srcline"><span class="lineno"><a href="104,25" id="srcline25">25</a></span><span class="line">    <span class="mxinfo " id="T3:U72"><span class="var type1" id="S22T3U118">w</span> = <span class="mxinfo " id="T3:U74"><span class="mxinfo " id="T3:U75"><span class="mxinfo " id="T3:U76">2</span> * <span class="mxinfo " id="T3:U77">pi</span></span> * <span class="mxinfo " id="T3:U78"><span class="var type1" id="S15T36U125">f</span>(<span class="var type1" id="S21T3U126">naux</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="104,26" id="srcline26">26</a></span><span class="line">    <span class="mxinfo " id="T47:U81"><span class="var type1" id="S24T47U129">Haux0</span> = <span class="mxinfo " id="T47:U83">[<span class="mxinfo " id="T83:U84"><span class="mxinfo " id="T44:U85"><span class="mxinfo " id="T44:U86">exp(<span class="mxinfo " id="T44:U87"><span class="mxinfo " id="T44:U88"><span class="mxinfo " id="T44:U89">-1i</span>*<span class="var type1" id="S22T3U139">w</span></span>*<span class="var type1" id="S19T3U140">tLL</span></span>)</span>/<span class="var type1" id="S16T3U141">dLL</span></span>, <span class="mxinfo " id="T44:U93"><span class="mxinfo " id="T44:U94">exp(<span class="mxinfo " id="T44:U95"><span class="mxinfo " id="T44:U96"><span class="mxinfo " id="T44:U97">-1i</span>*<span class="var type1" id="S22T3U149">w</span></span>*<span class="var type1" id="S20T3U150">tLR</span></span>)</span>/<span class="var type1" id="S18T3U151">dLR</span></span></span>; <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="104,27" id="srcline27">27</a></span><span class="line">             <span class="mxinfo " id="T83:U101"><span class="mxinfo " id="T44:U102"><span class="mxinfo " id="T44:U103">exp(<span class="mxinfo " id="T44:U104"><span class="mxinfo " id="T44:U105"><span class="mxinfo " id="T44:U106">-1i</span>*<span class="var type1" id="S22T3U160">w</span></span>*<span class="var type1" id="S20T3U161">tLR</span></span>)</span>/<span class="var type1" id="S18T3U162">dLR</span></span>, <span class="mxinfo " id="T44:U110"><span class="mxinfo " id="T44:U111">exp(<span class="mxinfo " id="T44:U112"><span class="mxinfo " id="T44:U113"><span class="mxinfo " id="T44:U114">-1i</span>*<span class="var type1" id="S22T3U170">w</span></span>*<span class="var type1" id="S19T3U171">tLL</span></span>)</span>/<span class="var type1" id="S16T3U172">dLL</span></span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="104,28" id="srcline28">28</a></span><span class="line">    <span class="mxinfo " id="T47:U118"><span class="mxinfo " id="T47:U119"><span class="var type1" id="S10T81U176">C</span>(<span class="mxinfo " id="T84:U121">:</span>,<span class="mxinfo " id="T84:U122">:</span>,<span class="var type1" id="S21T3U179">naux</span>)</span> = <span class="mxinfo " id="T47:U124"><span class="mxinfo " id="T47:U125">inv((<span class="mxinfo " id="T47:U126"><span class="mxinfo " id="T47:U127"><span class="mxinfo " id="T47:U128"><span class="var type1" id="S24T47U187">Haux0</span>'</span> * <span class="var type1" id="S24T47U188">Haux0</span></span> + <span class="mxinfo " id="T50:U131"><span class="var type1" id="S7T3U190">beta</span> * <span class="mxinfo " id="T50:U133">eye(2)</span></span></span>))</span> * <span class="mxinfo " id="T47:U134"><span class="var type1" id="S24T47U195">Haux0</span>'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="104,29" id="srcline29">29</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="104,30" id="srcline30">30</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="104,31" id="srcline31">31</a></span><span class="line"><span class="comment">% Reconstrucción del espectro completo con simetría Hermitiana</span></span></span>
<span class="srcline"><span class="lineno"><a href="104,32" id="srcline32">32</a></span><span class="line"><span class="mxinfo " id="T65:U136"><span class="var type1" id="S28T65U198">CLL_spec</span> = <span class="mxinfo " id="T65:U138">[<span class="mxinfo " id="T62:U139">squeeze(<span class="mxinfo " id="T60:U140"><span class="var type1" id="S10T81U204">C</span>(<span class="mxinfo " id="T27:U142">1</span>,<span class="mxinfo " id="T27:U143">1</span>,<span class="mxinfo " id="T85:U144">:</span>)</span>)</span>; <span class="mxinfo " id="T44:U145">0</span>; <span class="mxinfo " id="T64:U146">conj(<span class="mxinfo " id="T64:U147">squeeze(<span class="mxinfo " id="T63:U148"><span class="var type1" id="S10T81U216">C</span>(<span class="mxinfo " id="T27:U150">1</span>,<span class="mxinfo " id="T27:U151">1</span>,<span class="mxinfo " id="T86:U152">end:-1:2</span>)</span>)</span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="104,33" id="srcline33">33</a></span><span class="line"><span class="mxinfo " id="T65:U153"><span class="var type1" id="S32T65U228">CLR_spec</span> = <span class="mxinfo " id="T65:U155">[<span class="mxinfo " id="T62:U156">squeeze(<span class="mxinfo " id="T60:U157"><span class="var type1" id="S10T81U234">C</span>(<span class="mxinfo " id="T27:U159">2</span>,<span class="mxinfo " id="T27:U160">1</span>,<span class="mxinfo " id="T85:U161">:</span>)</span>)</span>; <span class="mxinfo " id="T44:U162">0</span>; <span class="mxinfo " id="T64:U163">conj(<span class="mxinfo " id="T64:U164">squeeze(<span class="mxinfo " id="T63:U165"><span class="var type1" id="S10T81U246">C</span>(<span class="mxinfo " id="T27:U167">2</span>,<span class="mxinfo " id="T27:U168">1</span>,<span class="mxinfo " id="T86:U169">end:-1:2</span>)</span>)</span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="104,34" id="srcline34">34</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="104,35" id="srcline35">35</a></span><span class="line"><span class="comment">% Obtener la respuesta al impulso (real)</span></span></span>
<span class="srcline"><span class="lineno"><a href="104,36" id="srcline36">36</a></span><span class="line"><span class="mxinfo " id="T26:U170"><span class="var type1" id="S2T26U258">cLL</span> = <span class="mxinfo " id="T26:U172">real(<span class="mxinfo " id="T65:U173">ifft(<span class="var type1" id="S28T65U263">CLL_spec</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="104,37" id="srcline37">37</a></span><span class="line"><span class="mxinfo " id="T26:U175"><span class="var type1" id="S3T26U266">cLR</span> = <span class="mxinfo " id="T26:U177">real(<span class="mxinfo " id="T65:U178">ifft(<span class="var type1" id="S32T65U271">CLR_spec</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="104,38" id="srcline38">38</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="104,39" id="srcline39">39</a></span><span class="line"><span class="comment">% Aplicar un pequeño retardo para hacer la respuesta causal</span></span></span>
<span class="srcline"><span class="lineno"><a href="104,40" id="srcline40">40</a></span><span class="line"><span class="mxinfo " id="T3:U180"><span class="var type1" id="S35T3U274">tdelay</span> = <span class="mxinfo " id="T3:U182">0.01</span></span>; <span class="comment">% 10 ms delay</span></span></span>
<span class="srcline"><span class="lineno"><a href="104,41" id="srcline41">41</a></span><span class="line"><span class="mxinfo " id="T3:U183"><span class="var type1" id="S36T3U278">ntdelay</span> = <span class="mxinfo " id="T3:U185">round(<span class="mxinfo " id="T3:U186"><span class="var type1" id="S35T3U282">tdelay</span> * <span class="var type1" id="S9T3U283">fs</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="104,42" id="srcline42">42</a></span><span class="line"><span class="mxinfo " id="T26:U189"><span class="var type1" id="S2T26U286">cLL</span> = <span class="mxinfo " id="T26:U191">circshift(<span class="var type1" id="S2T26U289">cLL</span>, <span class="var type1" id="S36T3U290">ntdelay</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="104,43" id="srcline43">43</a></span><span class="line"><span class="mxinfo " id="T26:U194"><span class="var type1" id="S3T26U293">cLR</span> = <span class="mxinfo " id="T26:U196">circshift(<span class="var type1" id="S3T26U296">cLR</span>, <span class="var type1" id="S36T3U297">ntdelay</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="104,44" id="srcline44">44</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="104,45" id="srcline45">45</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
</body>
</html>
